#! /usr/bin/perl

use strict;
use warnings;

use lib '../fw/package/rpm';
use FwRpmPackage;

my @tests = (
  [ '1', '1', 0 ],
  [ '1', '2', -1 ],
  [ '2', '1', 1 ],
  [ '1.0', '1.0', 0 ],
  [ '1.0', '2.0', -1 ],
  [ '2.0', '1.0', 1 ],
  [ '1.0', '1.1', -1 ],
  [ '1.1', '2.0', -1 ],
  [ '10', '1', 1 ],
  [ '1', '10', -1 ],
  [ '001', '1', 0 ],
  [ '01', '10', -1 ],
  [ '10', '01', 1 ],
  [ '1a', '1b', -1 ],
  [ '1b', '1a', 1 ],
  [ '1', '1a', -1 ],
  [ '1.2.3', '1-2-3', 0 ],
  [ 'a123', 'a23', 1 ],
  [ '1.2.3', '1.1.0', 1 ],
  [ '1.2.3', '1.3.2', -1 ],
  [ '1.a.1', '1.b.1', -1 ],
  [ '1.b.1', '1.b.0', 1 ],
  [ '1.c.1', '1.b.2', 1 ],
  [ 'alpha', 'beta', -1 ],
  [ 'gamma', 'beta', 1 ],
  [ '1.a.2', '1a2', 0 ],
  [ '1.a.2', '1.2', -1 ],
  [ '5.0.77', '5.00.77', 0 ],
  [ '5.01.77', '5.2.74', -1 ],
  [ '1.0p1', '1.0p2', -1 ],
  [ '1.0p1', '1.0', 1 ],
  [ '2010010201', '2010010202', -1 ],
);

my $failed = 0;
foreach my $t (@tests) {
  my $r = rpmvercmp($t->[0], $t->[1]);
  if ($r != $t->[2]) {
    print "rpmvercmp failed: $t->[0] cmp $t->[1] returned $r, expected $t->[2]\n";
    $failed = 1;
  }
}

exit($failed);
